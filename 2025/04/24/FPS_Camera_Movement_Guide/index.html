
<!DOCTYPE html><html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1" theme-name="Stellar" theme-version="1.29.1">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  
  <title>Implementing FPS Camera Movement in a 3D Application - Anya's Blog</title>

  
    <meta name="description" content="Implementing FPS Camera Movement in a 3D ApplicationFirst-Person Shooter (FPS) camera movement is a core mechanic in many 3D applications, providing an immersive perspective where the camera mimics th">
<meta property="og:type" content="article">
<meta property="og:title" content="Implementing FPS Camera Movement in a 3D Application">
<meta property="og:url" content="http://example.com/2025/04/24/FPS_Camera_Movement_Guide/index.html">
<meta property="og:site_name" content="Anya&#39;s Blog">
<meta property="og:description" content="Implementing FPS Camera Movement in a 3D ApplicationFirst-Person Shooter (FPS) camera movement is a core mechanic in many 3D applications, providing an immersive perspective where the camera mimics th">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-04-23T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-24T16:53:33.225Z">
<meta property="article:author" content="AnyaCoder">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="FPS">
<meta property="article:tag" content="Graphics">
<meta property="article:tag" content="Camera">
<meta property="article:tag" content="3D">
<meta property="article:tag" content="SDL">
<meta name="twitter:card" content="summary">
  
  
  
  <meta name="keywords" content="C++,FPS,Graphics,Camera,3D,SDL">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.29.1">

  
    <link rel="shortcut icon" href="/%5Bobject%20Object%5D">
  

  

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web/style.css" />
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/avatar.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">Anya's Blog</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="Search"></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div>


<nav class="menu dis-select"></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">Recent Update</span></div><div class="widget-body fs14"><a class="item title" href="/2025/04/24/FPS_Camera_Movement_Guide/"><span class="title">Implementing FPS Camera Movement in a 3D Application</span></a><a class="item title" href="/2025/04/25/Mipmap/"><span class="title">Mipmap 实现详解：从原理到代码（含数学推导）</span></a><a class="item title" href="/2025/04/18/ThreadPool/"><span class="title">优化软渲染器：线程池设计与性能提升</span></a><a class="item title" href="/2025/04/16/SDL/"><span class="title">使用 SDL 窗口化实时渲染：设计 Scene 和 SDLApp 组件</span></a><a class="item title" href="/2025/04/15/MATMUL_ACCELERATION/"><span class="title">加速小型矩阵乘法：3x3与4x4优化</span></a><a class="item title" href="/2025/04/15/QUATERNION/"><span class="title">使用四元数和变换类管理对象姿态</span></a><a class="item title" href="/2025/04/13/TEXTURE-MAPPINGS/"><span class="title">增强真实感：为软渲染器添加 AO、高光和光泽度贴图</span></a><a class="item title" href="/2025/04/04/Z-BUFFER-IMPLEMENTATION/"><span class="title">Z-Buffer 深度缓冲的实现</span></a><a class="item title" href="/2025/04/06/RENDERING-PIPELINE/"><span class="title">渲染管线简介</span></a><a class="item title" href="/2025/04/05/PERSPECTIVE-PROJECTION/"><span class="title">透视投影</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/Computer-Graphics/">Computer Graphics</a></div>
<div class="flex-row" id="post-meta"><span class="text created">Posted on: <time datetime="2025-04-23T16:00:00.000Z">2025-04-24</time></span><span class="sep updated"></span><span class="text updated">Updated on: <time datetime="2025-04-24T16:53:33.225Z">2025-04-25</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>Implementing FPS Camera Movement in a 3D Application</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="Implementing-FPS-Camera-Movement-in-a-3D-Application"><a href="#Implementing-FPS-Camera-Movement-in-a-3D-Application" class="headerlink" title="Implementing FPS Camera Movement in a 3D Application"></a>Implementing FPS Camera Movement in a 3D Application</h1><p>First-Person Shooter (FPS) camera movement is a core mechanic in many 3D applications, providing an immersive perspective where the camera mimics the viewpoint of a character. This guide details how to implement an FPS-style camera based on the provided codebase changes, which use C++, SDL, and a custom 3D rendering engine. The implementation covers mouse-based look controls, keyboard-based movement, and integration with a scene management system.</p>
<h2 id="Overview-of-Changes"><a href="#Overview-of-Changes" class="headerlink" title="Overview of Changes"></a>Overview of Changes</h2><p>The provided diff modifies several files to enable FPS-style camera controls. Key changes include:</p>
<ul>
<li><strong>Camera Class Overhaul</strong> (<code>camera.h</code>, <code>camera.cpp</code>): The <code>Camera</code> class now uses yaw and pitch for orientation instead of a target-based look-at system, enabling smoother FPS-style mouse look. New methods handle keyboard and mouse input for movement and rotation.</li>
<li><strong>SDL Application Enhancements</strong> (<code>sdl_app.h</code>, <code>sdl_app.cpp</code>): Input handling now tracks keyboard states and mouse motion, with a toggle for mouse look mode (using the Escape key).</li>
<li><strong>Scene Loading</strong> (<code>scene.yaml</code>, <code>scene.cpp</code>): The scene configuration supports yaw and pitch for camera initialization, replacing the target-based setup.</li>
<li><strong>Math Utilities</strong> (<code>vector.h</code>, <code>quaternion.h</code>, <code>transform.cpp</code>): Optimizations like <code>lengthSq()</code> and improved numerical stability for vector and quaternion operations.</li>
<li><strong>Miscellaneous</strong>:<ul>
<li><code>CMakeLists.txt</code>: Switches ImGui to a static library.</li>
<li><code>blinn_phong_shader.cpp</code>, <code>model.cpp</code>: Minor optimizations using <code>lengthSq()</code> for performance.</li>
<li><code>resource_manager.cpp</code>, <code>main.cpp</code>: Minor cleanup and logging improvements.</li>
</ul>
</li>
</ul>
<p>This guide focuses on the FPS camera implementation, explaining the core components and how they integrate.</p>
<h2 id="Step-by-Step-Implementation"><a href="#Step-by-Step-Implementation" class="headerlink" title="Step-by-Step Implementation"></a>Step-by-Step Implementation</h2><h3 id="1-Camera-Class-Design"><a href="#1-Camera-Class-Design" class="headerlink" title="1. Camera Class Design"></a>1. Camera Class Design</h3><p>The <code>Camera</code> class (<code>include/core/camera.h</code>, <code>src/core/camera.cpp</code>) is the heart of the FPS camera system. It manages position, orientation (via yaw and pitch), and projection matrices for rendering.</p>
<h4 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features"></a>Key Features</h4><ul>
<li><strong>Constructor</strong>: Initializes the camera with a position, yaw, and pitch, defaulting to a forward-facing view (yaw &#x3D; -90°, pitch &#x3D; 0°).<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Camera::<span class="built_in">Camera</span>(<span class="type">const</span> vec3f&amp; position, <span class="type">float</span> initialYaw, <span class="type">float</span> initialPitch)</span><br><span class="line">    : <span class="built_in">m_yaw</span>(initialYaw), <span class="built_in">m_pitch</span>(initialPitch) &#123;</span><br><span class="line">    m_transform.position = position;</span><br><span class="line">    m_projMatrix = mat4::<span class="built_in">identity</span>();</span><br><span class="line">    <span class="built_in">updateCameraVectors</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>Orientation</strong>: Uses yaw (Y-axis rotation) and pitch (X-axis rotation) to compute a quaternion-based rotation, avoiding gimbal lock compared to Euler angles.</li>
<li><strong>Movement</strong>: Supports keyboard-driven movement (WASD, Space, Ctrl) and mouse-driven look controls.</li>
<li><strong>View Matrix</strong>: Computed using a stable look-at construction based on the camera’s forward vector.</li>
</ul>
<h4 id="Orientation-and-Rotation"><a href="#Orientation-and-Rotation" class="headerlink" title="Orientation and Rotation"></a>Orientation and Rotation</h4><p>The camera’s orientation is defined by:</p>
<ul>
<li><strong>Yaw</strong>: Rotation around the world’s Y-axis (up).</li>
<li><strong>Pitch</strong>: Rotation around the camera’s local X-axis (right).</li>
</ul>
<p>The <code>updateRotationAndVectors</code> method computes the rotation quaternion:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Camera::updateRotationAndVectors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    quat yawQuat = quat::<span class="built_in">fromAxisAngle</span>(m_worldUp, m_yaw * Q_DEG2RAD);</span><br><span class="line">    vec3f localRight = vec3f&#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;;</span><br><span class="line">    quat pitchQuat = quat::<span class="built_in">fromAxisAngle</span>(localRight, m_pitch * Q_DEG2RAD);</span><br><span class="line">    m_transform.rotation = yawQuat * pitchQuat;</span><br><span class="line">    m_transform.rotation.<span class="built_in">normalize</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Yaw is applied first (global rotation), then pitch (local rotation), ensuring intuitive FPS controls.</li>
<li>The rotation is normalized to prevent numerical drift.</li>
</ul>
<p>The view matrix is updated in <code>updateViewMatrix</code> using the camera’s forward, right, and up vectors, derived from the rotation:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Camera::updateViewMatrix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vec3f position = m_transform.position;</span><br><span class="line">    vec3f forward = <span class="built_in">getForward</span>();</span><br><span class="line">    vec3f targetPoint = position + forward;</span><br><span class="line">    vec3f actualForward = (targetPoint - position).<span class="built_in">normalized</span>();</span><br><span class="line">    vec3f actualRight = actualForward.<span class="built_in">cross</span>(m_worldUp).<span class="built_in">normalized</span>();</span><br><span class="line">    <span class="keyword">if</span> (actualRight.<span class="built_in">lengthSq</span>() &lt; <span class="number">1e-6f</span>) &#123;</span><br><span class="line">        quat yawQuatOnly = quat::<span class="built_in">fromAxisAngle</span>(m_worldUp, m_yaw * Q_DEG2RAD);</span><br><span class="line">        actualRight = yawQuatOnly * vec3f&#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    vec3f actualUp = actualRight.<span class="built_in">cross</span>(actualForward).<span class="built_in">normalized</span>();</span><br><span class="line">    mat4 rotation = mat4::<span class="built_in">identity</span>();</span><br><span class="line">    rotation.m[<span class="number">0</span>][<span class="number">0</span>] = actualRight.x; rotation.m[<span class="number">0</span>][<span class="number">1</span>] = actualRight.y; rotation.m[<span class="number">0</span>][<span class="number">2</span>] = actualRight.z;</span><br><span class="line">    rotation.m[<span class="number">1</span>][<span class="number">0</span>] = actualUp.x;    rotation.m[<span class="number">1</span>][<span class="number">1</span>] = actualUp.y;    rotation.m[<span class="number">1</span>][<span class="number">2</span>] = actualUp.z;</span><br><span class="line">    rotation.m[<span class="number">2</span>][<span class="number">0</span>] = -actualForward.x; rotation.m[<span class="number">2</span>][<span class="number">1</span>] = -actualForward.y; rotation.m[<span class="number">2</span>][<span class="number">2</span>] = -actualForward.z;</span><br><span class="line">    mat4 translation = mat4::<span class="built_in">translation</span>(-position.x, -position.y, -position.z);</span><br><span class="line">    m_viewMatrix = rotation * translation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This handles edge cases (e.g., looking straight up&#x2F;down) to prevent gimbal lock or instability.</p>
<h4 id="Mouse-Look"><a href="#Mouse-Look" class="headerlink" title="Mouse Look"></a>Mouse Look</h4><p>Mouse movement adjusts yaw and pitch:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Camera::processMouseMovement</span><span class="params">(<span class="type">float</span> xoffset, <span class="type">float</span> yoffset, <span class="type">float</span> sensitivity, <span class="type">bool</span> constrainPitch)</span> </span>&#123;</span><br><span class="line">    xoffset *= sensitivity;</span><br><span class="line">    yoffset *= sensitivity;</span><br><span class="line">    m_yaw += xoffset;</span><br><span class="line">    m_pitch += yoffset;</span><br><span class="line">    m_yaw = <span class="built_in">fmod</span>(m_yaw, <span class="number">360.0f</span>);</span><br><span class="line">    <span class="keyword">if</span> (m_yaw &lt; <span class="number">0.0f</span>) m_yaw += <span class="number">360.0f</span>;</span><br><span class="line">    <span class="keyword">if</span> (constrainPitch) &#123;</span><br><span class="line">        m_pitch = std::<span class="built_in">clamp</span>(m_pitch, <span class="number">-89.0f</span>, <span class="number">89.0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">updateRotationAndVectors</span>();</span><br><span class="line">    <span class="built_in">updateViewMatrix</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Sensitivity</strong>: Scales mouse input for smoother control.</li>
<li><strong>Pitch Constraint</strong>: Limits pitch to ±89° to prevent flipping at the poles.</li>
<li><strong>Yaw Wrapping</strong>: Keeps yaw in [0, 360°) for continuity.</li>
</ul>
<h4 id="Keyboard-Movement"><a href="#Keyboard-Movement" class="headerlink" title="Keyboard Movement"></a>Keyboard Movement</h4><p>Keyboard input moves the camera along its forward, right, and world-up axes:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Camera::processKeyboardMovement</span><span class="params">(<span class="type">const</span> vec3f&amp; direction, <span class="type">float</span> deltaTime, <span class="type">float</span> speed)</span> </span>&#123;</span><br><span class="line">    <span class="type">float</span> velocity = speed * deltaTime;</span><br><span class="line">    vec3f moveAmount = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;;</span><br><span class="line">    vec3f currentForward = <span class="built_in">getForward</span>();</span><br><span class="line">    vec3f horizontalRight = -m_worldUp.<span class="built_in">cross</span>(currentForward).<span class="built_in">normalized</span>();</span><br><span class="line">    moveAmount = moveAmount + currentForward * direction.z * velocity;</span><br><span class="line">    moveAmount = moveAmount + horizontalRight * direction.x * velocity;</span><br><span class="line">    moveAmount = moveAmount + m_worldUp * direction.y * velocity;</span><br><span class="line">    m_transform.position = m_transform.position + moveAmount;</span><br><span class="line">    <span class="built_in">updateViewMatrix</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Direction</strong>: A vector where <code>x</code> is strafe (left&#x2F;right), <code>y</code> is vertical (up&#x2F;down), and <code>z</code> is forward&#x2F;backward.</li>
<li><strong>Delta Time</strong>: Ensures frame-rate-independent movement.</li>
<li><strong>Speed</strong>: Controls movement speed (default: 5 units&#x2F;second).</li>
</ul>
<h3 id="2-Input-Handling-in-SDLApp"><a href="#2-Input-Handling-in-SDLApp" class="headerlink" title="2. Input Handling in SDLApp"></a>2. Input Handling in SDLApp</h3><p>The <code>SDLApp</code> class (<code>include/core/sdl_app.h</code>, <code>src/core/sdl_app.cpp</code>) processes user input and updates the camera.</p>
<h4 id="Keyboard-Input"><a href="#Keyboard-Input" class="headerlink" title="Keyboard Input"></a>Keyboard Input</h4><p>Keyboard state is tracked using an <code>std::unordered_set</code> for pressed keys:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::unordered_set&lt;SDL_Scancode&gt; keysPressed;</span><br></pre></td></tr></table></figure>
<p>The <code>handleEvents</code> method updates this set:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!io.WantCaptureKeyboard) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (event.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> SDL_KEYDOWN:</span><br><span class="line">            <span class="keyword">if</span> (event.key.repeat == <span class="number">0</span>) &#123;</span><br><span class="line">                keysPressed.<span class="built_in">insert</span>(event.key.keysym.scancode);</span><br><span class="line">                <span class="keyword">if</span> (event.key.keysym.scancode == SDL_SCANCODE_ESCAPE) &#123;</span><br><span class="line">                    mouseLookActive = !mouseLookActive;</span><br><span class="line">                    std::cout &lt;&lt; <span class="string">&quot;Escape Toggle: mouseLookActive = &quot;</span> &lt;&lt; mouseLookActive &lt;&lt; std::endl;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> SDL_KEYUP:</span><br><span class="line">            keysPressed.<span class="built_in">erase</span>(event.key.keysym.scancode);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ImGui Integration</strong>: Input is ignored if ImGui (UI) wants keyboard focus.</li>
<li><strong>Escape Key</strong>: Toggles mouse look mode.</li>
</ul>
<p>The <code>processInput</code> method maps keys to movement:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">SDLApp::processInput</span><span class="params">(<span class="type">float</span> dt)</span> </span>&#123;</span><br><span class="line">    vec3f moveDir = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (keysPressed.<span class="built_in">count</span>(SDL_SCANCODE_W)) moveDir.z += <span class="number">1.0f</span>; <span class="comment">// Forward</span></span><br><span class="line">    <span class="keyword">if</span> (keysPressed.<span class="built_in">count</span>(SDL_SCANCODE_S)) moveDir.z -= <span class="number">1.0f</span>; <span class="comment">// Backward</span></span><br><span class="line">    <span class="keyword">if</span> (keysPressed.<span class="built_in">count</span>(SDL_SCANCODE_A)) moveDir.x -= <span class="number">1.0f</span>; <span class="comment">// Left</span></span><br><span class="line">    <span class="keyword">if</span> (keysPressed.<span class="built_in">count</span>(SDL_SCANCODE_D)) moveDir.x += <span class="number">1.0f</span>; <span class="comment">// Right</span></span><br><span class="line">    <span class="keyword">if</span> (keysPressed.<span class="built_in">count</span>(SDL_SCANCODE_SPACE)) moveDir.y += <span class="number">1.0f</span>; <span class="comment">// Up</span></span><br><span class="line">    <span class="keyword">if</span> (keysPressed.<span class="built_in">count</span>(SDL_SCANCODE_LCTRL) || keysPressed.<span class="built_in">count</span>(SDL_SCANCODE_RCTRL)) moveDir.y -= <span class="number">1.0f</span>; <span class="comment">// Down</span></span><br><span class="line">    <span class="keyword">if</span> (moveDir.<span class="built_in">lengthSq</span>() &gt; <span class="number">1.0f</span>) &#123;</span><br><span class="line">        moveDir.<span class="built_in">normalize</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (moveDir.x != <span class="number">0.0f</span> || moveDir.y != <span class="number">0.0f</span> || moveDir.z != <span class="number">0.0f</span>) &#123;</span><br><span class="line">        scene.<span class="built_in">getCamera</span>().<span class="built_in">processKeyboardMovement</span>(moveDir, dt, cameraMoveSpeed);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Normalization</strong>: Ensures diagonal movement (e.g., W+A) doesn’t exceed the intended speed.</li>
<li><strong>WASD Controls</strong>: Standard FPS movement (W: forward, S: backward, A: strafe left, D: strafe right).</li>
<li><strong>Vertical Movement</strong>: Space (up) and Ctrl (down) allow free-fly movement, typical in debug or creative modes.</li>
</ul>
<h4 id="Mouse-Input"><a href="#Mouse-Input" class="headerlink" title="Mouse Input"></a>Mouse Input</h4><p>Mouse look is enabled when <code>mouseLookActive</code> is true, using SDL’s relative mouse mode:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mouseLookActive) &#123;</span><br><span class="line">    <span class="type">int</span> mouseXRel, mouseYRel;</span><br><span class="line">    <span class="built_in">SDL_GetRelativeMouseState</span>(&amp;mouseXRel, &amp;mouseYRel);</span><br><span class="line">    <span class="keyword">if</span> (mouseXRel != <span class="number">0</span> || mouseYRel != <span class="number">0</span>) &#123;</span><br><span class="line">        scene.<span class="built_in">getCamera</span>().<span class="built_in">processMouseMovement</span>(</span><br><span class="line">            -<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(mouseXRel),</span><br><span class="line">            -<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(mouseYRel),</span><br><span class="line">            cameraLookSensitivity</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Relative Mouse Mode</strong>: Captures mouse movement without cursor bounds, ideal for FPS controls.</li>
<li><strong>Sensitivity</strong>: Adjustable via <code>cameraLookSensitivity</code> (default: 0.1).</li>
<li><strong>Cursor Visibility</strong>: Hidden when mouse look is active, shown otherwise.</li>
</ul>
<p>The <code>handleEvents</code> method toggles mouse mode and cursor visibility:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> shouldBeRelative = mouseLookActive &amp;&amp; !imguiCapturedMouseThisPoll;</span><br><span class="line"><span class="type">bool</span> currentRelativeState = <span class="built_in">SDL_GetRelativeMouseMode</span>();</span><br><span class="line"><span class="keyword">if</span> (shouldBeRelative != currentRelativeState) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">SDL_SetRelativeMouseMode</span>(shouldBeRelative ? SDL_TRUE : SDL_FALSE) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">SDL_ShowCursor</span>(shouldBeRelative ? SDL_DISABLE : SDL_ENABLE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ImGui Compatibility</strong>: Mouse look is disabled if ImGui captures the mouse (e.g., for UI interaction).</li>
</ul>
<h3 id="3-Scene-Configuration"><a href="#3-Scene-Configuration" class="headerlink" title="3. Scene Configuration"></a>3. Scene Configuration</h3><p>The scene file (<code>scenes/scene.yaml</code>) initializes the camera:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">camera:</span></span><br><span class="line">  <span class="attr">position:</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line">  <span class="attr">yaw:</span> <span class="number">0.0</span></span><br><span class="line">  <span class="attr">pitch:</span> <span class="number">0.0</span></span><br><span class="line">  <span class="attr">width:</span> <span class="number">800</span></span><br><span class="line">  <span class="attr">height:</span> <span class="number">800</span></span><br><span class="line">  <span class="attr">fov:</span> <span class="number">45.0</span></span><br><span class="line">  <span class="attr">near:</span> <span class="number">0.1</span></span><br><span class="line">  <span class="attr">far:</span> <span class="number">100.0</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Position</strong>: Starting point (x, y, z).</li>
<li><strong>Yaw&#x2F;Pitch</strong>: Initial orientation.</li>
<li><strong>Perspective</strong>: Field of view (FOV), aspect ratio, and clipping planes.</li>
</ul>
<p>The <code>Scene</code> class (<code>src/core/scene.cpp</code>) loads these settings:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (cameraNode) &#123;</span><br><span class="line">    vec3f position = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">5.0f</span>&#125;;</span><br><span class="line">    <span class="type">float</span> yaw = <span class="number">-90.0f</span>;</span><br><span class="line">    <span class="type">float</span> pitch = <span class="number">0.0f</span>;</span><br><span class="line">    <span class="keyword">if</span> (cameraNode[<span class="string">&quot;position&quot;</span>]) position = cameraNode[<span class="string">&quot;position&quot;</span>].as&lt;std::vector&lt;<span class="type">float</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (cameraNode[<span class="string">&quot;yaw&quot;</span>]) yaw = cameraNode[<span class="string">&quot;yaw&quot;</span>].<span class="built_in">as</span>&lt;<span class="type">float</span>&gt;();</span><br><span class="line">    <span class="keyword">if</span> (cameraNode[<span class="string">&quot;pitch&quot;</span>]) pitch = cameraNode[<span class="string">&quot;pitch&quot;</span>].<span class="built_in">as</span>&lt;<span class="type">float</span>&gt;();</span><br><span class="line">    camera.<span class="built_in">setPosition</span>(position);</span><br><span class="line">    camera.<span class="built_in">setPitchYaw</span>(pitch, yaw);</span><br><span class="line">    <span class="type">float</span> fov = <span class="number">60.0f</span>, aspect = <span class="number">1.0f</span>, near = <span class="number">0.1f</span>, far = <span class="number">100.0f</span>;</span><br><span class="line">    <span class="keyword">if</span> (cameraNode[<span class="string">&quot;fov&quot;</span>]) fov = cameraNode[<span class="string">&quot;fov&quot;</span>].<span class="built_in">as</span>&lt;<span class="type">float</span>&gt;();</span><br><span class="line">    <span class="keyword">if</span> (cameraNode[<span class="string">&quot;width&quot;</span>] &amp;&amp; cameraNode[<span class="string">&quot;height&quot;</span>] &amp;&amp; cameraNode[<span class="string">&quot;height&quot;</span>].<span class="built_in">as</span>&lt;<span class="type">float</span>&gt;() != <span class="number">0</span>) &#123;</span><br><span class="line">        aspect = cameraNode[<span class="string">&quot;width&quot;</span>].<span class="built_in">as</span>&lt;<span class="type">float</span>&gt;() / cameraNode[<span class="string">&quot;height&quot;</span>].<span class="built_in">as</span>&lt;<span class="type">float</span>&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    camera.<span class="built_in">setPerspective</span>(fov, aspect, near, far);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Defaults</strong>: Provides fallback values if YAML fields are missing.</li>
<li><strong>Flexible Aspect Ratio</strong>: Supports width&#x2F;height or direct aspect ratio.</li>
</ul>
<h3 id="4-ImGui-Integration"><a href="#4-ImGui-Integration" class="headerlink" title="4. ImGui Integration"></a>4. ImGui Integration</h3><p>The ImGui interface (<code>sdl_app.cpp</code>) displays camera properties and controls:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ImGui::<span class="built_in">Begin</span>(<span class="string">&quot;Inspector&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (ImGui::<span class="built_in">CollapsingHeader</span>(<span class="string">&quot;Camera&quot;</span>, ImGuiTreeNodeFlags_DefaultOpen)) &#123;</span><br><span class="line">    vec3f position = scene.<span class="built_in">getCamera</span>().<span class="built_in">getPosition</span>();</span><br><span class="line">    vec3f rotation = scene.<span class="built_in">getCamera</span>().<span class="built_in">getTransform</span>().rotation.<span class="built_in">toEulerAnglesZYX</span>();</span><br><span class="line">    ImGui::<span class="built_in">InputFloat3</span>(<span class="string">&quot;Position##Cam&quot;</span>, &amp;position.x, <span class="string">&quot;%.2f&quot;</span>, ImGuiInputTextFlags_ReadOnly);</span><br><span class="line">    ImGui::<span class="built_in">InputFloat3</span>(<span class="string">&quot;Rotation##Cam&quot;</span>, &amp;rotation.x, <span class="string">&quot;%.2f&quot;</span>, ImGuiInputTextFlags_ReadOnly);</span><br><span class="line">    ImGui::<span class="built_in">DragFloat</span>(<span class="string">&quot;Move Speed&quot;</span>, &amp;cameraMoveSpeed, <span class="number">0.1f</span>, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">    ImGui::<span class="built_in">DragFloat</span>(<span class="string">&quot;Look Sensitivity&quot;</span>, &amp;cameraLookSensitivity, <span class="number">0.01f</span>, <span class="number">0.01f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    <span class="type">bool</span> mouseLookStatus = mouseLookActive;</span><br><span class="line">    <span class="keyword">if</span> (ImGui::<span class="built_in">Checkbox</span>(<span class="string">&quot;Mouse Look Active (Esc)&quot;</span>, &amp;mouseLookStatus)) &#123;</span><br><span class="line">        mouseLookActive = mouseLookStatus;</span><br><span class="line">        <span class="built_in">SDL_SetRelativeMouseMode</span>(mouseLookActive ? SDL_TRUE : SDL_FALSE);</span><br><span class="line">        <span class="built_in">SDL_ShowCursor</span>(mouseLookActive ? SDL_DISABLE : SDL_ENABLE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ImGui::<span class="built_in">End</span>();</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Read-Only Display</strong>: Shows position and rotation for debugging.</li>
<li><strong>Adjustable Parameters</strong>: Allows tweaking movement speed and look sensitivity.</li>
<li><strong>Mouse Look Toggle</strong>: Mirrors the Escape key functionality.</li>
</ul>
<h3 id="5-Math-Optimizations"><a href="#5-Math-Optimizations" class="headerlink" title="5. Math Optimizations"></a>5. Math Optimizations</h3><p>The math library (<code>vector.h</code>, <code>quaternion.h</code>, <code>transform.cpp</code>) supports the camera with:</p>
<ul>
<li><strong>Vector3</strong>: Added <code>lengthSq()</code> for faster length checks without square roots:<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">float</span> <span class="title">lengthSq</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x * x + y * y + z * z; &#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>Quaternion</strong>: Improved numerical stability in <code>toAxisAngle</code> and <code>toEulerAnglesZYX</code>:<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (axis.<span class="built_in">lengthSq</span>() &lt; <span class="number">1e-6f</span>) axis = <span class="built_in">vec3f</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br></pre></td></tr></table></figure></li>
<li><strong>Transform</strong>: Enhanced <code>lookAt</code> with robust handling of edge cases (e.g., parallel vectors).</li>
</ul>
<p>These optimizations reduce computational overhead and improve stability for camera calculations.</p>
<h2 id="Integration-with-the-Application"><a href="#Integration-with-the-Application" class="headerlink" title="Integration with the Application"></a>Integration with the Application</h2><p>The FPS camera is integrated into the main loop in <code>SDLApp::run</code> (<code>sdl_app.cpp</code>):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!quit) &#123;</span><br><span class="line">    <span class="built_in">updateFPS</span>();</span><br><span class="line">    <span class="built_in">processInput</span>(deltaTime);</span><br><span class="line">    <span class="built_in">update</span>(deltaTime);</span><br><span class="line">    <span class="built_in">renderFrame</span>();</span><br><span class="line">    <span class="built_in">updateTextureFromFramebuffer</span>();</span><br><span class="line">    <span class="built_in">renderImGui</span>();</span><br><span class="line">    <span class="built_in">render</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Input Processing</strong>: <code>processInput</code> updates the camera based on keyboard and mouse input.</li>
<li><strong>Rendering</strong>: The camera’s view and projection matrices are passed to the renderer for scene rendering.</li>
<li><strong>ImGui</strong>: Provides real-time feedback and control.</li>
</ul>
<h2 id="Best-Practices-and-Tips"><a href="#Best-Practices-and-Tips" class="headerlink" title="Best Practices and Tips"></a>Best Practices and Tips</h2><ol>
<li><strong>Frame-Rate Independence</strong>: Always scale movement by <code>deltaTime</code> to ensure consistent speed across hardware.</li>
<li><strong>Numerical Stability</strong>: Use <code>lengthSq()</code> for comparisons and normalize quaternions to prevent drift.</li>
<li><strong>User Comfort</strong>: Constrain pitch to avoid disorienting flips and provide adjustable sensitivity.</li>
<li><strong>ImGui Integration</strong>: Ensure input is disabled when ImGui is active to prevent conflicts.</li>
<li><strong>Debugging</strong>: Use ImGui to display camera state and log warnings for YAML parsing errors.</li>
</ol>
<h2 id="Potential-Enhancements"><a href="#Potential-Enhancements" class="headerlink" title="Potential Enhancements"></a>Potential Enhancements</h2><ul>
<li><strong>Collision Detection</strong>: Prevent the camera from moving through objects.</li>
<li><strong>Smoothing</strong>: Add interpolation for smoother mouse look.</li>
<li><strong>Configurable Keybindings</strong>: Allow users to remap WASD controls.</li>
<li><strong>Camera Shake</strong>: Implement for visual effects (e.g., explosions).</li>
<li><strong>Field of View Adjustment</strong>: Add dynamic FOV for sprinting or zooming.</li>
</ul>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This FPS camera implementation provides a robust foundation for 3D applications, with smooth mouse look, intuitive keyboard movement, and seamless integration with SDL and ImGui. By leveraging yaw&#x2F;pitch orientation, quaternion rotations, and optimized math utilities, the system ensures performance and stability. The provided codebase is extensible, making it easy to add features like collision detection or advanced input handling.</p>
<p>For further details, refer to the source files (<code>camera.h/cpp</code>, <code>sdl_app.h/cpp</code>, <code>scene.cpp</code>) and experiment with the scene configuration (<code>scene.yaml</code>) to customize the camera’s behavior.</p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>License</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">Newer</div><a href="/2025/04/25/Mipmap/">Mipmap 实现详解：从原理到代码（含数学推导）</a></div><div class="item" id="next"><div class="note">Older</div><a href="/2025/04/18/ThreadPool/">优化软渲染器：线程池设计与性能提升</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">AnyaCoder</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1">Stellar 1.29.1</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">On This Page</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Implementing-FPS-Camera-Movement-in-a-3D-Application"><span class="toc-text">Implementing FPS Camera Movement in a 3D Application</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview-of-Changes"><span class="toc-text">Overview of Changes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-by-Step-Implementation"><span class="toc-text">Step-by-Step Implementation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Camera-Class-Design"><span class="toc-text">1. Camera Class Design</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Key-Features"><span class="toc-text">Key Features</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Orientation-and-Rotation"><span class="toc-text">Orientation and Rotation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mouse-Look"><span class="toc-text">Mouse Look</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyboard-Movement"><span class="toc-text">Keyboard Movement</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Input-Handling-in-SDLApp"><span class="toc-text">2. Input Handling in SDLApp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyboard-Input"><span class="toc-text">Keyboard Input</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mouse-Input"><span class="toc-text">Mouse Input</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Scene-Configuration"><span class="toc-text">3. Scene Configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-ImGui-Integration"><span class="toc-text">4. ImGui Integration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Math-Optimizations"><span class="toc-text">5. Math Optimizations</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Integration-with-the-Application"><span class="toc-text">Integration with the Application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Best-Practices-and-Tips"><span class="toc-text">Best Practices and Tips</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Potential-Enhancements"><span class="toc-text">Potential Enhancements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>Scroll to Top</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `Just`,
      min: `minutes ago`,
      hour: `hours ago`,
      day: `days ago`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js`,
    marked: `https://cdn.jsdelivr.net/npm/marked@13.0.1/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.29.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `Switched to Light Mode`,
      dark: `Switched to Dark Mode`,
      auto: `Switched to Auto Mode`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
